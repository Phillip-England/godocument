<!doctype html><html lang=en loaded=false zez:dark=dark zez:light=light><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Explore the integration of Htmx in Godocument to achieve a Single Page Application experience without the complexity of a full JavaScript framework. Learn about the implications of using hx-boost, managing JavaScript execution, and handling event listeners to ensure smooth navigation and interaction within your documentation site."><script src=http://localhost:8080/static/js/prism.js crossorigin=anonymous></script><script src=https://unpkg.com/htmx.org@1.9.11 integrity=sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0 crossorigin=anonymous></script><link rel=stylesheet href=http://localhost:8080/static/css/index.css><link rel=icon href=http://localhost:8080/favicon.ico type=image/x-icon><title>Godocument - Scripting</title>
<body hx-boost=true class="custom-scroll h-full w-full flex invisible text-[var(--default-text-color)] bg-[var(--default-bg-color)] dark:text-[var(--dark-default-text-color)] dark:bg-[var(--dark-default-bg-color)]" zez:loaded=!visible><div id=root class="w-full grid"><header id=header class="flex flex-row justify-between items-center border-b z-30 p-4 sticky top-0 w-full bg-[var(--header-bg-color)] dark:bg-[var(--dark-header-bg-color)] border-[var(--b-color)] dark:border-[var(--dark-b-color)]" style=grid-area:header><div class="header-logo-wrapper flex flex-row shrink-0 items-center w-[250px]"><img class="logo items-center flex-row" src=http://localhost:8080/static/img/logo.svg alt=logo id=logo></div><svg class="sun cursor-pointer hidden lg:block shrink-0 dark:lg:hidden" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5V3m0 18v-2M7.05 7.05 5.636 5.636m12.728 12.728L16.95 16.95M5 12H3m18 0h-2M7.05 16.95l-1.414 1.414M18.364 5.636 16.95 7.05M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><svg class="moon cursor-pointer hidden shrink-0 dark:lg:block" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 01-.5-17.986V3c-.354.966-.5 1.911-.5 3a9 9 0 009 9c.239.0.254.018.488.0A9.004 9.004.0 0112 21z"/></svg><svg id="bars" class="cursor-pointer block lg:hidden shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-width="2" d="M5 7h14M5 12h14M5 17h14"/></svg></header><div id=content-wrapper class=grid style=grid-area:content-wrapper><nav id=sitenav class="fixed top-0 w-[80%] lg:w-auto lg:sticky hidden overflow-y-scroll custom-scroll sm-scroll lg:block lg:top-[75px] h-screen border-r border-[var(--b-color)] dark:border-[var(--dark-b-color)] z-50 lg:z-0 bg-[var(--sitenav-bg-color)] dark:bg-[var(--dark-sitenav-bg-color)]" zez:active=!block style=grid-area:sitenav><div class="flex flex-row justify-between items-center text-md h-[75px] p-4 border-b border-[var(--b-color)] dark:border-[var(--dark-b-color)] lg:hidden"><div class="flex flex-row items-center justify-between w-[250px]"><div class=flex><img class=logo src=http://localhost:8080/static/img/logo.svg alt=logo id=logo></div></div><div class="flex items-center"><svg class="sun cursor-pointer dark:hidden" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5V3m0 18v-2M7.05 7.05 5.636 5.636m12.728 12.728L16.95 16.95M5 12H3m18 0h-2M7.05 16.95l-1.414 1.414M18.364 5.636 16.95 7.05M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><svg class="moon cursor-pointer hidden dark:block" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 01-.5-17.986V3c-.354.966-.5 1.911-.5 3a9 9 0 009 9c.239.0.254.018.488.0A9.004 9.004.0 0112 21z"/></svg></div></div><ul class="sitenav-list flex flex-col p-2 gap-1"><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/>Introduction</a><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/installation.html>Installation</a><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/configuration.html>Configuration</a><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/theming.html>Theming</a><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/custom-components.html>Custom Components</a><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/scripting.html>Scripting</a><li class=pl-0><a class="item flex flex-row justify-between items-center rounded-md font-bold p-2 hover:bg-[var(--bg-hover-color)] hover:dark:bg-[var(--dark-bg-hover-color)]" zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)] bg-[var(--bg-hover-color)] dark:bg-[var(--dark-bg-hover-color)]" href=http://localhost:8080/building.html>Building</a></ul></nav><main id=main class=grid style=grid-area:main><article id=article class="2xl:pl-40 xl:pr-8 2xl:py-4 lg:pl-8 p-4 flex flex-col gap-6 break-words" style=grid-area:article><h1 id=scripting>Scripting</h1><h2 id=single-page-application>Single Page Application</h2><p>Godocument uses <a href=https://htmx.org>Htmx</a> to provide a single page application user experience. Htmx enables us to do this without the complexity of a Javascript framework.<p>This functionality is enabled by a single attribute on our <code>&lt;body></code> tag, <a href=https://htmx.org/attributes/hx-boost>hx-boost</a>.<pre><code class=language-html>&lt;body hx-boost=&#39;true&#39; ...&gt;
</code></pre><p>Basically, when you click on a navigational link within your website, Htmx will take over and the following will happen:<ol><li>An AJAX request will be sent to the <code>href</code> of the clicked <code>&lt;a></code>.<li>When the response is received, the <code>&lt;body></code> from the response will be isolated.<li>Our page's current <code>&lt;body></code> will be replaced with the newly received <code>&lt;body></code>.</ol><p>All of this will be done without a full-page refresh. Since we are generating static pages, the wait time between when a request is clicked and when the response is receieved will be minimal, giving the illusion of a single page experience to the user.<h2 id=htmx-implications>Htmx Implications</h2><p>Using Htmx's <code>hx-boost</code> attribute has implications on how we need to think about using Javascript in our application.<p><md-important>Since the <code>&lt;body></code> is the only thing changed when using <code>hx-boost</code>, the Javascript located in the <code>&lt;head></code> of our document will only be loaded once. However, Javascript located in the <code>&lt;body></code> will be ran on each request.</md-important><p>This can create issues when declaring functions, declaring variables, and mounting event listeners.<h2 id=loaded-attribute>loaded attribute</h2><p>Godocument makes use of an attribute, <code>loaded</code>, on the <code>&lt;html></code> tag to avoid reinstantiating variables multiple times.<pre><code class=language-html>&lt;html lang=&#34;en&#34; loaded=&#34;false&#34; ..&gt;
</code></pre><p>After the page is loaded on the initial visit, this attribute is set to <code>true</code>. This will prevent our variables and functions from being instantiated more than once.<p><md-warning>Failing to set <code>loaded="true"</code> on <code>&lt;html></code> will result in unexpected behavior</md-warning><h2 id=onload-function>onLoad function</h2><p>Godocument makes use of the function <code>onLoad()</code> to run the appropriate Javascript on all page loads.<pre><code class=language-js>function onLoad() {

    // elements
    const body = qs(document, &#39;body&#39;)
    const sitenav = qs(document, &#39;#sitenav&#39;)
    const sitenavItems = qsa(sitenav, &#39;.item&#39;)
    const sitenavDropdowns = qsa(sitenav, &#39;.dropdown&#39;)
    const pagenav = qs(document, &#39;#pagenav&#39;)
    const pagenavLinks = qsa(pagenav, &#39;a&#39;)
    const article = qs(document, &#39;#article&#39;)
    const articleTitles = qsa(article, &#39;h2, h3, h4, h5, h6&#39;)
    const header = qs(document, &#39;#header&#39;)
    const headerBars = qs(header, &#39;#bars&#39;)
    const overlay = qs(document, &#39;#overlay&#39;)
    const sunIcons = qsa(document, &#39;.sun&#39;)
    const moonIcons = qsa(document, &#39;.moon&#39;)
    const htmlDocument = qs(document, &#39;html&#39;)

    // hooking events and running initializations
    window.scrollTo(0, 0, { behavior: &#39;auto&#39; })
    new SiteNav(sitenav, sitenavItems, sitenavDropdowns, header, overlay)
    new PageNav(pagenav, pagenavLinks, articleTitles)
    new Header(headerBars, overlay, sitenav)
    new Theme(sunIcons, moonIcons, htmlDocument)

    // web components
    doOnce(() =&gt; {
        customElements.define(&#39;md-important&#39;, MdImportant)
        customElements.define(&#39;md-warning&#39;, MdWarning)
        customElements.define(&#39;md-correct&#39;, MdCorrect)
    })

    // init
    Prism.highlightAll();

    // reveal body
    zez.applyState(body, &#39;loaded&#39;)

}
</code></pre><p><code>onLoad()</code> is mounted to the <code>window</code> and <code>&lt;body></code> using the <code>DOMContentLoaded</code> and <code>htmx:afterOnLoad</code> events. Click <a href=https://htmx.org/events/>here</a> to read more about Htmx events.<pre><code class=language-js>eReset(window, &#39;DOMContentLoaded&#39;, onLoad) // initial page load
eReset(document.getElementsByTagName(&#39;body&#39;)[0], &#34;htmx:afterOnLoad&#34;, onLoad) // after htmx swaps
</code></pre><p><md-important><code>DOMContentLoaded</code> will handle the initial page load, while <code>hmtx:afterOnLoad</code> will handle all other navigations.</md-important><h2 id=managing-events>Managing Events</h2><p>Since the page is never refreshed using Htmx, we need to make sure we are unmounting events and remounting them on every navigation. <code>eReset()</code> is a handy function that does just that.<pre><code class=language-js>function eReset(node, eventType, callback) {
    node.removeEventListener(eventType, callback)
    node.addEventListener(eventType, callback)
}
</code></pre><p>Instead of calling <code>element.addEventListener()</code>, it is better to use <code>eReset()</code> to ensure events are properly managed between page navigations.<p><md-warning>Failing to unhook events upon navigation will result in the same events being hooked multiple times to the target element, which can have unexpected consequences and lead to poor memory management.</md-warning><ul class="flex flex-row justify-between gap-8 my-12 list-none"><li class=w-full><a href=http://localhost:8080/custom-components.html target=_self class="text-[var(--text-important)] dark:text-[var(--dark-text-important)] border no-underline w-full p-4 flex-col hover:border-[var(--b-hover-color)] dark:hover:border-[var(--dark-b-hover-color)] flex rounded-md border-[var(--b-color)] dark:border-[var(--dark-b-color)]"><div><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m17 16-4-4 4-4m-6 8-4-4 4-4"/></svg></div><p class="font-bold text-sm">Custom Components</p></a><li class=w-full><a href=http://localhost:8080/building.html target=_self class="text-[var(--text-important)] dark:text-[var(--text-important)] border no-underline hover:border-[var(--b-hover-color)] dark:hover:border-[var(--dark-b-hover-color)] items-end w-full p-4 flex-col flex rounded-md border-[var(--b-color)] dark:border-[var(--dark-b-color)]"><div><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m7 16 4-4-4-4m6 8 4-4-4-4"/></svg></div><p class="font-bold text-sm">Building</p></a></ul></article><nav id=pagenav class="text-xs relative overflow-y-scroll custom-scroll sm-scroll bg-[var(--pagenav-bg-color)] dark:bg-[var(--dark-pagenav-bg-color)]" style=grid-area:pagenav><ul class="fixed p-4 border-l border-[var(--b-color)] dark:border-[var(--dark-b-color)] flex flex-col gap-2"><li><a href=#single-page-application class=cursor-pointer zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)]">Single Page Application</a><li><a href=#htmx-implications class=cursor-pointer zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)]">Htmx Implications</a><li><a href=#loaded-attribute class=cursor-pointer zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)]">loaded attribute</a><li><a href=#onload-function class=cursor-pointer zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)]">onLoad function</a><li><a href=#managing-events class=cursor-pointer zez:active="text-[var(--text-important)] dark:text-[var(--dark-text-important)]">Managing Events</a></ul></nav></main></div><footer id=footer class="flex p-6 bg-[var(--footer-bg-color)] dark:bg-[var(--dark-footer-bg-color)] border-t border-[var(--b-color)] dark:border-[var(--dark-b-color)] text-sm items-center justify-center z-30" style=grid-area:footer><p>Godocument © 2024 Created by <a href=https://github.com/phillip-england/godocument class="dark:text-[var(--dark-text-important)] text-[var(--text-important)] underline" target=_blank>Phillip England</a></footer><div id=overlay class="z-40 fixed top-0 h-screen w-screen bg-[var(--overlay-bg-color)] opacity-70 hidden lg:hidden" zez:active="!block lg:invisible"></div></div><script src=http://localhost:8080/static/js/index.js></script>